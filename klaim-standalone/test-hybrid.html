<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜ì´ë¸Œë¦¬ë“œ AI ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            background: #f9f9f9;
        }
        .test-button {
            background: #4EA699;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
        }
        .test-button:hover {
            background: #3d8b7e;
        }
        .result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <h1>ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ AI ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
    <p>ê¸°ì¡´ HTML operations + ìƒˆë¡œìš´ Actionsë¥¼ ì¡°í•©í•œ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</p>

    <!-- HTML Operations í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>ğŸ“ HTML Operations í…ŒìŠ¤íŠ¸</h2>
        <p>ë‹¨ìˆœ í…ìŠ¤íŠ¸/ìƒ‰ìƒ ë³€ê²½ (ê¸°ì¡´ ë°©ì‹)</p>
        
        <button class="test-button" onclick="testTextChange()">ì œëª© ë³€ê²½ í…ŒìŠ¤íŠ¸</button>
        <button class="test-button" onclick="testColorChange()">ìƒ‰ìƒ ë³€ê²½ í…ŒìŠ¤íŠ¸</button>
        
        <div id="html-operations-result" class="result" style="display: none;"></div>
    </div>

    <!-- Actions í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>ğŸš€ Actions í…ŒìŠ¤íŠ¸</h2>
        <p>ë³µì¡í•œ DOM ì¡°ì‘ (ìƒˆë¡œìš´ ë°©ì‹)</p>
        
        <button class="test-button" onclick="testAddPlan()">í”Œëœ ì¶”ê°€ í…ŒìŠ¤íŠ¸</button>
        <button class="test-button" onclick="testDeletePlan()">í”Œëœ ì‚­ì œ í…ŒìŠ¤íŠ¸</button>
        <button class="test-button" onclick="testBulkUpdate()">ëŒ€ëŸ‰ í”Œëœ ìƒì„± í…ŒìŠ¤íŠ¸</button>
        
        <div id="actions-result" class="result" style="display: none;"></div>
    </div>

    <!-- í•˜ì´ë¸Œë¦¬ë“œ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ í…ŒìŠ¤íŠ¸</h2>
        <p>HTML operations + Actions ì¡°í•© ì²˜ë¦¬</p>
        
        <button class="test-button" onclick="testHybridSimple()">ì œëª© ë³€ê²½ + í”Œëœ ì¶”ê°€</button>
        <button class="test-button" onclick="testHybridComplex()">ë³µí•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</button>
        
        <div id="hybrid-result" class="result" style="display: none;"></div>
    </div>

    <!-- ìì—°ì–´ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>ğŸ’¬ ìì—°ì–´ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h2>
        <p>ì‹¤ì œ ì‚¬ìš©ì ìš”ì²­ê³¼ ìœ ì‚¬í•œ ìì—°ì–´ ì…ë ¥</p>
        
        <input type="text" id="natural-input" placeholder="ì˜ˆ: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì„¸ì¼ë¡œ ì œëª© ë°”ê¾¸ê³  3ê°œ í”Œëœ ë§Œë“¤ì–´ì¤˜'" style="width: 60%; padding: 0.5rem;">
        <button class="test-button" onclick="testNaturalLanguage()">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        
        <div id="natural-result" class="result" style="display: none;"></div>
    </div>

    <script type="module">
        // ë§¤ë‹ˆì €ë“¤ import
        let aiHandler, htmlManager, actionManager;

        async function initializeManagers() {
            try {
                console.log('ğŸ”„ í…ŒìŠ¤íŠ¸ ë§¤ë‹ˆì €ë“¤ ì´ˆê¸°í™”...');
                
                // ë§¤ë‹ˆì €ë“¤ ë™ì  import
                const { default: htmlMgr } = await import('./js/html-manager.js');
                const { default: actionMgr } = await import('./js/action-manager.js');
                const { default: aiHdlr } = await import('./js/ai-handler.js');
                
                htmlManager = htmlMgr;
                actionManager = actionMgr;
                aiHandler = aiHdlr;
                
                // ì „ì—­ì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ
                window.htmlManager = htmlManager;
                window.actionManager = actionManager;
                window.aiHandler = aiHandler;
                
                console.log('âœ… í…ŒìŠ¤íŠ¸ ë§¤ë‹ˆì €ë“¤ ì´ˆê¸°í™” ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ë§¤ë‹ˆì € ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initializeManagers);

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤ì„ ì „ì—­ì— ë…¸ì¶œ
        window.testTextChange = testTextChange;
        window.testColorChange = testColorChange;
        window.testAddPlan = testAddPlan;
        window.testDeletePlan = testDeletePlan;
        window.testBulkUpdate = testBulkUpdate;
        window.testHybridSimple = testHybridSimple;
        window.testHybridComplex = testHybridComplex;
        window.testNaturalLanguage = testNaturalLanguage;

        // HTML Operations í…ŒìŠ¤íŠ¸ë“¤
        async function testTextChange() {
            const resultDiv = document.getElementById('html-operations-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [
                        {
                            search: '<h1 class="brand-name" contenteditable="true" id="brand-name">JasonCom</h1>',
                            replace: '<h1 class="brand-name" contenteditable="true" id="brand-name">Winter Sale</h1>',
                            description: 'ë¸Œëœë“œëª…ì„ Winter Saleë¡œ ë³€ê²½'
                        }
                    ],
                    actions: [],
                    response: {
                        summary: 'ì œëª©ì„ Winter Saleë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.'
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                
                resultDiv.textContent = `HTML Operations í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${JSON.stringify(aiResponse, null, 2)}`;
                resultDiv.className = aiResponse.success ? 'result success' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testColorChange() {
            const resultDiv = document.getElementById('html-operations-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ìƒ‰ìƒ ë³€ê²½ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [
                        {
                            search: '--primary-color: #4EA699;',
                            replace: '--primary-color: #e53e3e;',
                            description: 'ì£¼ìš” ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½'
                        }
                    ],
                    actions: [],
                    response: {
                        summary: 'ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ í…Œë§ˆë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.'
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                
                resultDiv.textContent = `ìƒ‰ìƒ ë³€ê²½ í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${JSON.stringify(aiResponse, null, 2)}`;
                resultDiv.className = aiResponse.success ? 'result success' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // Actions í…ŒìŠ¤íŠ¸ë“¤
        async function testAddPlan() {
            const resultDiv = document.getElementById('actions-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'í”Œëœ ì¶”ê°€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [],
                    actions: [
                        {
                            type: 'ADD_PLAN',
                            data: {
                                name: 'Premium',
                                price: 99,
                                type: 'paid',
                                description: 'Premium plan with advanced features'
                            },
                            description: 'Premium í”Œëœ ì¶”ê°€'
                        }
                    ],
                    response: {
                        summary: 'Premium í”Œëœì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.'
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                
                resultDiv.textContent = `í”Œëœ ì¶”ê°€ í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${JSON.stringify(aiResponse, null, 2)}`;
                resultDiv.className = aiResponse.success ? 'result success' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testDeletePlan() {
            const resultDiv = document.getElementById('actions-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'í”Œëœ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [],
                    actions: [
                        {
                            type: 'DELETE_PLAN',
                            data: { index: 1 },
                            description: 'ë‘ ë²ˆì§¸ í”Œëœ ì‚­ì œ'
                        }
                    ],
                    response: {
                        summary: 'ë‘ ë²ˆì§¸ í”Œëœì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.'
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                
                resultDiv.textContent = `í”Œëœ ì‚­ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${JSON.stringify(aiResponse, null, 2)}`;
                resultDiv.className = aiResponse.success ? 'result success' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testBulkUpdate() {
            const resultDiv = document.getElementById('actions-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ëŒ€ëŸ‰ í”Œëœ ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [],
                    actions: [
                        {
                            type: 'BULK_UPDATE_PRICING',
                            data: {
                                plans: [
                                    { name: 'Starter', price: 29, type: 'paid', description: 'Perfect for beginners' },
                                    { name: 'Pro', price: 99, type: 'paid', description: 'For professionals' },
                                    { name: 'Enterprise', price: 299, type: 'paid', description: 'For large teams' }
                                ]
                            },
                            description: '3ê°œ í”Œëœ ì¼ê´„ ìƒì„±'
                        }
                    ],
                    response: {
                        summary: '3ê°œ í”Œëœì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.'
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                
                resultDiv.textContent = `ëŒ€ëŸ‰ í”Œëœ ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${JSON.stringify(aiResponse, null, 2)}`;
                resultDiv.className = aiResponse.success ? 'result success' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // í•˜ì´ë¸Œë¦¬ë“œ í…ŒìŠ¤íŠ¸ë“¤
        async function testHybridSimple() {
            const resultDiv = document.getElementById('hybrid-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'í•˜ì´ë¸Œë¦¬ë“œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [
                        {
                            search: '<h1 class="brand-name" contenteditable="true" id="brand-name">JasonCom</h1>',
                            replace: '<h1 class="brand-name" contenteditable="true" id="brand-name">Christmas Sale</h1>',
                            description: 'ì œëª©ì„ Christmas Saleë¡œ ë³€ê²½'
                        }
                    ],
                    actions: [
                        {
                            type: 'ADD_PLAN',
                            data: {
                                name: 'Holiday Special',
                                price: 49,
                                type: 'paid',
                                description: 'Limited time holiday offer'
                            },
                            description: 'Holiday Special í”Œëœ ì¶”ê°€'
                        }
                    ],
                    response: {
                        summary: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì„¸ì¼ ì œëª©ìœ¼ë¡œ ë³€ê²½í•˜ê³  Holiday Special í”Œëœì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.',
                        details: ['ì œëª©: Christmas Sale', 'Holiday Special í”Œëœ ì¶”ê°€ ($49)']
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                const finalResult = aiHandler.generateHybridResponse(mockResponse.response, aiResponse);
                
                resultDiv.textContent = `í•˜ì´ë¸Œë¦¬ë“œ ì²˜ë¦¬ ê²°ê³¼:\n${JSON.stringify(finalResult, null, 2)}`;
                resultDiv.className = finalResult.type === 'success' ? 'result success' : 
                                  finalResult.type === 'warning' ? 'result warning' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function testHybridComplex() {
            const resultDiv = document.getElementById('hybrid-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'ë³µí•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            resultDiv.className = 'result';

            try {
                const mockResponse = {
                    operations: [
                        {
                            search: '--primary-color: #4EA699;',
                            replace: '--primary-color: #dc2626;',
                            description: 'ì£¼ìš” ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½'
                        }
                    ],
                    actions: [
                        {
                            type: 'BULK_UPDATE_PRICING',
                            data: {
                                plans: [
                                    { name: 'Black Friday Starter', price: 19, type: 'paid', description: 'Special discount' },
                                    { name: 'Black Friday Pro', price: 49, type: 'paid', description: 'Best value' },
                                    { name: 'Black Friday Ultimate', price: 99, type: 'paid', description: 'Everything included' }
                                ]
                            }
                        }
                    ],
                    response: {
                        summary: 'Black Friday í…Œë§ˆë¡œ ìƒ‰ìƒê³¼ í”Œëœì„ ëª¨ë‘ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.',
                        suggestions: ['ë§Œë£Œì¼ì„ 11ì›” 30ì¼ë¡œ ì„¤ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?']
                    }
                };

                const aiResponse = await aiHandler.executeHybridOperations(mockResponse);
                const finalResult = aiHandler.generateHybridResponse(mockResponse.response, aiResponse);
                
                resultDiv.textContent = `ë³µí•© ì‹œë‚˜ë¦¬ì˜¤ ê²°ê³¼:\n${finalResult.message}`;
                resultDiv.className = finalResult.type === 'success' ? 'result success' : 
                                  finalResult.type === 'warning' ? 'result warning' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        // ìì—°ì–´ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (ì‹¤ì œ AI í˜¸ì¶œ)
        async function testNaturalLanguage() {
            const input = document.getElementById('natural-input');
            const resultDiv = document.getElementById('natural-result');
            
            if (!input.value.trim()) {
                alert('í…ŒìŠ¤íŠ¸í•  ìì—°ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'AI ì²˜ë¦¬ ì¤‘...';
            resultDiv.className = 'result';

            try {
                if (!aiHandler) {
                    throw new Error('AI Handlerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

                const result = await aiHandler.processUserMessage(input.value);
                
                resultDiv.textContent = `ìì—°ì–´ ì²˜ë¦¬ ê²°ê³¼:\n${result.message}`;
                resultDiv.className = result.type === 'success' ? 'result success' : 
                                  result.type === 'warning' ? 'result warning' : 
                                  result.type === 'clarification' ? 'result warning' : 'result error';

            } catch (error) {
                resultDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }
    </script>
</body>
</html>